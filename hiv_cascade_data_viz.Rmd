---
title: "HIV Treatment Cascade - Data Visualization"
author: "Brittany Bowman"
date: "10/8/2019"
output: html_document
runtime: shiny
---

This file provides a script for visualizing the HIV treatment cascade data from UNAIDS from 2015-2018 related to progress towards the 90-90-90 targets.
```{r setup, include=FALSE echo = FALSE}
# load necessary packages
library(tidyverse)
library(shiny)
library(plotly)
library(scales)
library(ggthemes)
library(RColorBrewer)
library(grDevices)

# get working directory
getwd()

# load tidy datasets (g = global datasets, c = country datasets)
full_cascade_g <- read_rds("data/tidy_data/full_cascade_global_tidy")
full_cascade_c <- read_rds("data/tidy_data/full_cascade_country_tidy")

know_status_g <- read_rds("data/tidy_data/know_status_all_global_tidy")
know_status_c <- read_rds("data/tidy_data/know_status_all_country_tidy")

on_art_g <- read_rds("data/tidy_data/on_art_all_global_tidy")
on_art_c <- read_rds("data/tidy_data/on_art_all_country_tidy")

vl_suppress_g <- read_rds("data/tidy_data/vl_suppress_all_global_tidy")
vl_suppress_c <- read_rds("data/tidy_data/vl_suppress_all_country_tidy")
```


```{r}
# define color palette (RBrewerPal palette Set1 with black inserted for global)
custom_palette <- c("#E41A1C", "#377EB8", "#4DAF4A", "#984EA3", "#000000", "#FF7F00", "#FFFF33", "#A65628", "#F781BF")
```


```{r}
# plot percent of people living with HIV who know their status
know_status_g %>% 
  ggplot(aes(x = year, y = estimate, color = Region, group = rev(Region))) + 
  geom_point(alpha = 0.75) + 
  geom_line(alpha = 0.75) +
  geom_hline(yintercept = 90, alpha = 0.75, linetype = 3) + 
  theme_tufte() +
  theme(text = element_text(family = "Helvetica"),
        plot.title = element_text(face = "bold", size = 16, color = "grey20"),
        plot.title.position = "plot",
        plot.subtitle = element_text(margin = margin(b = 16)),
        plot.caption = element_text(hjust = 0, margin = margin(t = 10)),
        plot.caption.position = "plot",
        axis.line.x = element_line(colour = "grey20", size = 0.25, linetype = "solid"), 
        axis.line.y = element_line(colour = "grey20", size = 0.25, linetype = "solid"),
        axis.text = element_text(size = 10),
        legend.title = element_blank(),
        legend.text = element_text(size = 10)) +
  scale_color_manual(values = custom_palette) +
  scale_y_continuous(labels = percent_format(scale = 1),
                     breaks = pretty_breaks(n = 5), 
                     expand = expansion(add = 10)) +
  scale_x_discrete(expand = expansion(add = 0.1)) +
  labs(x = NULL, y = NULL, 
       title = "Percent of people living with HIV who know their status by region",
       subtitle = "Figure based on modeled estimates from UNAIDS for all ages",
       caption = "Source: UNAIDS special analysis, 2019") +
  annotate("text", x = 3.3, y = 92, 
           label = "paste(bold(\"UNAIDS target:\"), \" 90% of people living with HIV know their status by 2020\")", 
           parse = TRUE, size = 3.2, color = "grey20") +
  annotate("curve", x = 4, xend = 4.05, y = 92, yend = 90.3, 
           curvature = -0.9, angle = 90,
           arrow = arrow(length = unit(0.01, "npc")),
           color = "grey20")
```


```{r}
vl_suppress_g %>% 
  ggplot(aes(x = year, y = estimate, color = Region, group = Region)) + 
  geom_point(alpha = 0.75) + 
  geom_line(alpha = 0.75) +
  geom_hline(yintercept = 90, alpha = 0.2, linetype = 3) + 
  theme_tufte() +
  scale_color_manual(values = custom_palette) +
  scale_y_continuous(labels = percent_format(scale = 1), 
                     breaks = pretty_breaks(n = 8), 
                     expand = expansion(.2)) +
  labs(x = NULL, y = NULL, 
       title = "Percent of people living with HIV who know their status",
       caption = "Source: UNAIDS special analysis, 2019")

```

